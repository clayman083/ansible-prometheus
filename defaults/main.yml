---

prometheus:
  dir: "{{ services_dir }}/prometheus"
  rules_dir: "{{ services_dir }}/prometheus/rules.d"

  node_exporter:
    host: "{{ private_network.address }}"
    port: 9100

    container:
      image: prom/node-exporter:latest
      name: node_exporter
      dns: "{{ private_network.address }}"
      network: ""
      restart: always

      syslog:
        enabled: no
        host: unixgram:///dev/log
        tag: node_exporter

    service:
      name: node-exporter
      tags:
        - "{{ env }}"
      meta:
        hostname: "{{ ansible_hostname }}"
        tier: "{{ env }}"

  cadvisor_exporter:
    host: "{{ private_network.address }}"
    port: 8080

    container:
      image: google/cadvisor:latest
      name: cadvisor_exporter
      dns: "{{ private_network.address }}"
      network: ""
      restart: always

      syslog:
        enabled: no
        host: unixgram:///dev/log
        tag: cadvisor_exporter

    service:
      name: cadvisor-exporter
      tags:
        - "{{ env }}"
      meta:
        hostname: "{{ ansible_hostname }}"
        tier: "{{ env }}"

  docker_exporter:
    host: "{{ private_network.address }}"
    port: 9323

    service:
      name: docker-exporter
      tags:
        - "{{ env }}"
      meta:
        hostname: "{{ ansible_hostname }}"
        tier: "{{ env }}"

  server:
    enabled: no

    host: "{{ private_network.address }}"
    port: 9090

    storage_retention: 30d

    exporters: []

    services: []

    rules:
      - node.rules.yml

    container:
      image: prom/prometheus:v2.2.1
      name: prometheus
      dns: "{{ private_network.address }}"
      network: ""
      restart: always

      syslog:
        enabled: no
        host: unixgram:///dev/log
        tag: prometheus

    service:
      name: prometheus
      tags:
        - "{{ env }}"
      meta:
        hostname: "{{ ansible_hostname }}"
        tier: "{{ env }}"

  alertmanager:
    enabled: no

    host: "{{ private_network.address }}"
    port: 9093

    container:
      name: alertmanager
      image: prom/alertmanager:v0.15.1
      dns: "{{ private_network.address }}"
      network: ""
      restart: always

      syslog:
        enabled: no
        host: unixgram:///dev/log
        tag: alertmanager

    slack:
      enabled: no
      api_url: ''
      channel: 'general'
      username: 'Prometheus'

    service:
      name: alertmanager
      tags:
        - "{{ env }}"
      meta:
        hostname: "{{ ansible_hostname }}"
        tier: "{{ env }}"
